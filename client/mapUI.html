<!DOCTYPE html>
<!--[if IEMobile 7 ]>    <html class="no-js iem7"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="cleartype" content="on">

        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/touch/apple-touch-icon-144x144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/touch/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/touch/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="img/touch/apple-touch-icon-57x57-precomposed.png">
        <link rel="shortcut icon" href="img/touch/apple-touch-icon.png">

        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="img/touch/apple-touch-icon-144x144-precomposed.png">
        <meta name="msapplication-TileColor" content="#222222">


        <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
        <!--
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="">
        -->

        <!-- This script prevents links from opening in Mobile Safari. https://gist.github.com/1042026 -->
        <!--
        <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
        -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/homepage.css">
        <link rel="stylesheet" href="css/mapUI.css">

        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
        <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?libraries=visualization&key=AIzaSyDlth022D4txU5HqXdDs1OZyGX0KdwKXIg&sensor=false">
    </script>
    <script src="js/markerwithlabel.js"></script>
    <script type="text/javascript">
var map, pointarray, heatmap, pickupMarker, markerFlag;
var markerType = -1;
var markerEvent;
var HELP_TRASH = 1;
var TRASH_DROP = 2;
var COMMENT_LOC = 3;
var MOUSEDOWN_TIME;
var MOUSEUP_TIME;

            var heatmapData = [
                {location: new google.maps.LatLng(37.782, -122.447), weight: 0.5}, 
                {location: new google.maps.LatLng(37.782, -122.445), weight: 1},
                {location: new google.maps.LatLng(37.782, -122.443), weight: 2},
                {location: new google.maps.LatLng(37.782, -122.441), weight: 3},
                {location: new google.maps.LatLng(37.782, -122.439), weight: 2},
                {location: new google.maps.LatLng(37.782, -122.437), weight: 1},
                {location: new google.maps.LatLng(37.782, -122.435), weight: 0.5},
                {location: new google.maps.LatLng(37.785, -122.447), weight: 3},
                {location: new google.maps.LatLng(37.785, -122.445), weight: 2},
                {location: new google.maps.LatLng(37.785, -122.443), weight: 1},
                {location: new google.maps.LatLng(37.785, -122.441), weight: 0.5},
                {location: new google.maps.LatLng(37.785, -122.439), weight: 1},
                {location: new google.maps.LatLng(37.785, -122.437), weight: 2},
                {location: new google.maps.LatLng(37.785, -122.435), weight: 3}
            ];
            
function initialize() {
    var mapOptions = {
    zoom: 13,
    center: new google.maps.LatLng(37.774546, -122.433523),
    mapTypeId: google.maps.MapTypeId.SATELLITE
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);

  var pointArray = new google.maps.MVCArray(heatmapData);

  heatmap = new google.maps.visualization.HeatmapLayer({
    data: pointArray,
    dissipating: true, 
    radius: 5
  });

  heatmap.setMap(map);
  
  google.maps.event.addListener(map, 'mousedown', markerSelectDown);
  google.maps.event.addListener(map, 'mouseup', markerSelectUp);
} // end initialize

function initIcons(){
var pickupIcon = "img/icons/greenCircle.png";
  pickupMarker = new google.maps.Marker({
      position: new google.maps.LatLng(37.785, -122.435),
      map: map,
      icon: pickupIcon
  });
  markerFlag = true;
}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function toggleIcons(){
    if(markerFlag){
        pickupMarker.setVisible(false);
        markerFlag = false;
    }else{
        pickupMarker.setVisible(true);
        markerFlag = true;
    };
}

// add an icon for a pickup
function addPickupMarker(){
    var marker = new google.maps.Marker({
        position: markerEvent.latLng,
        map: map,
        icon: "img/icons/greenCircle.png"
    });
}

// add an icon for a Comment location
function addCommentMarker(){
    var marker = new google.maps.Marker({
        position: markerEvent.latLng,
        map: map,
        icon: "img/icons/blueCircle.png"
    });

    // var marker = new MarkerWithLabel({
    //    position: markerEvent.latLng,
    //    draggable: true,
    //    raiseOnDrag: true,
    //    map: map,
    //    labelContent: "$425K",
    //    labelAnchor: new google.maps.Point(22, 0),
    //    labelClass: "labels", // the CSS class for the label
    //    labelStyle: {opacity: 0.75}
    //  });
}

// add an icon to indicate where trash was found
function addTrashMarker(){
    var marker = new google.maps.Marker({
        position: markerEvent.latLng,
        map: map,
        icon: "img/icons/redCircle.png"
    });
}

function markerSelectUp(event){
    markerEvent = event;
    MOUSEUP_TIME = new Date().getTime() / 1000;
    if((MOUSEUP_TIME - MOUSEDOWN_TIME) < 0.3){
        // alert((MOUSEUP_TIME - MOUSEDOWN_TIME));
        $('#markerTypeDialog').toggle();
        MOUSEDOWN_TIME =0;
        MOUSEDOWN_TIME =0;
    }else{
        MOUSEDOWN_TIME =0;
        MOUSEDOWN_TIME =0;
    }
}

function markerSelectDown(event){
    markerEvent = event;
    MOUSEDOWN_TIME = new Date().getTime() / 1000;
    // if((MOUSEUP_TIME - MOUSEDOWN_TIME) < 2){
    //     $('#markerTypeDialog').toggle();
    //     MOUSEDOWN_TIME =0;
    //     MOUSEDOWN_TIME =0;
    // }else{
    //     MOUSEDOWN_TIME =0;
    //     MOUSEDOWN_TIME =0;
    // }
}


function changeRadius() {
  heatmap.setOptions({radius: heatmap.get('radius') ? null : 20});
}

function changeOpacity() {
  heatmap.setOptions({opacity: heatmap.get('opacity') ? null : 0.2});
}

google.maps.event.addDomListener(window, 'load', initialize);
google.maps.event.addDomListener(window, 'load', initIcons);

$(document).ready(function(){
    // loadScript();
    $('#toggleHeat').click(function(){
        toggleHeatmap();
    });
    $('#toggleIcons').click(function(){
        toggleIcons();
    });

    $('#selectPickup').click(function(){
        $('#markerTypeDialog').toggle();
        addPickupMarker();
        // alert("hello");
    })
    $('#selectComment').click(function(){
        $('#markerTypeDialog').toggle();
        addCommentMarker();
        // alert("hello");
    })
    $('#selectTrash').click(function(){
        $('#markerTypeDialog').toggle();
        addTrashMarker();
        // alert("hello");
    })

    // $('#map-canvas').mousedown(function(){
    //     MOUSEDOWN_TIME = new Date().getTime() / 1000;
    // });
    // $('#map-canvas').mouseup(function(){
    //     MOUSEUP_TIME = new Date().getTime() / 1000;
    // });
});
</script>

    </head>
    <body>

        <!-- Add your site or application content here -->
        <div class="mobileContainer">
            <ul class="nav">
                <li><a href="homeUI.html">Home</a></li>
                <li><a href="mapUI.html">Maps</a></li>
                <li><a href="commUI.html">Comments</a></li>
            </ul>
        </div>

        <div class="mapContainer">
                <div id="map-canvas"></div>
                <div class="toggleContainer">
                    <input type="button" id="toggleHeat" value="Toggle Heat" />
                    <input type="button" id="toggleIcons" value="Toggle Icons" />
                </div>
        </div>

        <div id="markerTypeDialog">
            <div id="markerTypeDialogNest">
                <input type="button" value="Pickup point" id="selectPickup" />
                <input type="button" value="Comment point" id="selectComment" />
                <input type="button" value="Trash point" id="selectTrash" />
            </div>
          <!--   <input type="button" value="Lots of Trash" onClick="addTrashMarker">
            <input type="button" value="Comment point" onClick="addCommentMarker"> -->
        </div>

        <script src="js/vendor/zepto.min.js"></script>
        <script src="js/helper.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            var _gaq=[["_setAccount","UA-XXXXX-X"],["_trackPageview"]];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
            g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
            s.parentNode.insertBefore(g,s)}(document,"script"));
        </script>
    </body>
</html>
